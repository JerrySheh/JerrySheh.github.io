---
title: Linux系统漫游（二）
comments: true
abbrlink: 9cf7e81b
date: 2018-02-11 00:21:18
categories: linux
tags: Linux
---

漫游式梳理一下关于 Linux 的知识。

[上一篇](https://jerrysheh.github.io/post/4f4dc2a9.html)：

* Linux简介与版本
* 从开机到启动
* 文件系统
* 文本流
* 标准输入、标准输出、标准错误、重定向
* 管道
* Linux 架构

本篇：

* 进程
* 信号
* 从程序到进程
* 进程间通信
* 并发与同步

<!-- more -->

---

# Linux 进程

## 程序

在计算机组成原理中，我们知道计算机只是在重复做一些简单的指令动作，简单地说，计算机只是从内存中取指令或数据然后执行逻辑运算、移位运算或算术运算。而程序(program)，就是一系列指令对数据进行运算所构成的集合。

## 进程

进程是执行程序的过程。同一个程序可以执行多次，每次都可以在内存中开辟独立的空间来装载，从而产生多个进程。不同的进程还可以拥有各自独立的IO接口。

操作系统的一个重要功能就是为进程提供方便，比如说为进程分配内存空间，管理进程的相关信息等等。

> 在 Linux 中使用`ps`命令查看进程，用`pstree`查看进程树

当计算机开机的时候，内核(kernel)只建立了一个init进程。Linux内核并不提供直接建立新进程的系统调用。剩下的所有进程都是init进程通过fork机制建立的。新的进程要通过老的进程复制自身得到，这就是fork。

fork是一个系统调用。进程存活于内存中。每个进程都在内存中分配有属于自己的一片空间 (address space)。当进程fork的时候，Linux在内存中开辟出一片新的内存空间给新的进程，并将老的进程空间中的内容复制到新的空间中，此后两个进程同时运行。

## 父/子进程、孤儿进程、僵尸进程

在 Linux 中，子进程终结时，会通知父进程并清空自身所占内存，并在内核里留下退出信息（exit code，正常退出为0）。父进程得知子进程结束，会对该子进程使用wait系统调用。这个wait函数能从内核中取出子进程的退出信息，并清空该信息在内核中所占据的空间。

但是，如果父进程早于子进程终结，子进程就会成为一个孤儿(orphand)进程。孤儿进程会被过继给init进程，init进程也就成了该进程的父进程。init进程负责该子进程终结时调用wait函数。

当然，一个糟糕的程序（父进程没有回收子进程、释放子进程占用的资源）也完全可能造成子进程的退出信息滞留在内核中的状况，这样的情况下，子进程成为僵尸（zombie）进程。当大量僵尸进程积累时，内存空间会被挤占。

## Linux 中的线程

在Linux中，线程只是一种特殊的进程。多个线程之间可以共享内存空间和IO接口。所以，进程是Linux程序的唯一的实现方式。

> 但常通识上的理解和在高级语言编程中，进程和线程还是有区别的。

---

# Linux 信号

Linux以进程为单位来执行程序。`信号(signal)`就是一种向进程传递信息的方式。

相对于其他的`进程间通信方式(interprocess communication) `，比如pipe, shared memory)来说，信号所能传递的信息比较粗糙，只是一个整数。但正是由于传递的信息量少，信号也便于管理和使用。信号因此被经常地用于系统管理相关的任务，比如通知进程终结、中止或者恢复等等。

信号可以产生与内核或其他进程，但统一由内核(kernel)管理。也就是说，进程间通过信号传递信号时，首先发送给内核，再由内核传递给目标进程。如果一个进程收到信号，会执行对应该信号的操作，称为信号处理（signal disposition）。

从信号的生成到信号的传递的时间，信号处于等待(pending)状态。我们同样可以设计程序，让其生成的进程阻塞(block)某些信号，也就是让这些信号始终处于等待的状态，直到进程取消阻塞(unblock)或者无视信号。

## Linux 常见信号

* **SIGINT** ：当键盘按下CTRL+C从shell中发出信号，信号被传递给shell中前台运行的进程，对应该信号的默认操作是中断 (INTERRUPT) 该进程。

* **SIGQUIT** ：当键盘按下CTRL+\从shell中发出信号，信号被传递给shell中前台运行的进程，对应该信号的默认操作是退出 (QUIT) 该进程。

* **SIGTSTP**： 当键盘按下CTRL+Z从shell中发出信号，信号被传递给shell中前台运行的进程，对应该信号的默认操作是暂停 (STOP) 该进程。

* **SIGCONT**：用于通知暂停的进程继续。

* **SIGALRM**：起到定时器的作用，通常是程序在一定的时间之后才生成该信号。

## 信号处理

当进程决定执行信号的时候，有下面几种可能：

* **无视(ignore)信号**：信号被清除，进程本身不采取任何特殊的操作

* **默认(default)操作**：每个信号对应有一定的默认操作。比如上面SIGCONT用于继续进程。

* **自定义操作**：也叫做`获取 (catch) `信号。执行进程中预设的对应于该信号的操作。

---

# 从程序到进程

todo
