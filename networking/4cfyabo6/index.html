<!doctype html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="generator" content="VuePress 2.0.0-rc.18" /><meta name="theme" content="VuePress Theme Plume " /><script id="check-mac-os">document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))</script><script id="check-dark-mode">;(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = um === 'dark' || (um !== 'light' && sm);document.documentElement.dataset.theme = isDark ? 'dark' : 'light';})();</script><meta property="og:url" content="https://jerrysheh.com/networking/4cfyabo6/"><meta property="og:site_name" content="Jerry"><meta property="og:title" content="TCP之旅"><meta property="og:description" content="前言 前面两篇介绍 Socket 的文章中，简单描述了 Socket 网络编程的过程。这一篇，主要介绍一下 TCP 的工作原理。包含以下六点： TCP连接简介 TCP报文段 连接的建立和断开（三次握手，四次挥手） TCP可靠在哪里（序号、ACK回复、超时重传） 滑窗机制 拥塞控制机制 一、TCP连接简介 TCP 全称 Transmission Cont..."><meta property="og:type" content="article"><meta property="og:image" content="https://jerrysheh.com/images/TCPconnection.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-10-20T05:02:32.000Z"><meta property="article:tag" content="计算机网络"><meta property="article:modified_time" content="2024-10-20T05:02:32.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"TCP之旅","image":["https://jerrysheh.com/images/TCPconnection.png","https://jerrysheh.com/images/TCP3wayhandshake.png","https://jerrysheh.com/images/TCPsegment.png","https://jerrysheh.com/images/networking/tcp.jpg"],"dateModified":"2024-10-20T05:02:32.000Z","author":[]}</script><title>TCP之旅 | Jerry</title><meta name="description" content="前言 前面两篇介绍 Socket 的文章中，简单描述了 Socket 网络编程的过程。这一篇，主要介绍一下 TCP 的工作原理。包含以下六点： TCP连接简介 TCP报文段 连接的建立和断开（三次握手，四次挥手） TCP可靠在哪里（序号、ACK回复、超时重传） 滑窗机制 拥塞控制机制 一、TCP连接简介 TCP 全称 Transmission Cont..."><link rel="preload" href="/assets/style-B2qqPAU3.css" as="style"><link rel="stylesheet" href="/assets/style-B2qqPAU3.css"><link rel="modulepreload" href="/assets/app-D22ydJtp.js"><link rel="modulepreload" href="/assets/index.html-BvdOc8WZ.js"><link rel="prefetch" href="/assets/index.html-Ca-e3Ddg.js" as="script"><link rel="prefetch" href="/assets/index.html-D18-wnSN.js" as="script"><link rel="prefetch" href="/assets/index.html-Bme4ZDtY.js" as="script"><link rel="prefetch" href="/assets/index.html-kKdhglbO.js" as="script"><link rel="prefetch" href="/assets/index.html-BTfOhYD4.js" as="script"><link rel="prefetch" href="/assets/index.html-CjmqecVE.js" as="script"><link rel="prefetch" href="/assets/index.html-Bfnck56E.js" as="script"><link rel="prefetch" href="/assets/index.html-t-zropNE.js" as="script"><link rel="prefetch" href="/assets/index.html-D26Ba7aL.js" as="script"><link rel="prefetch" href="/assets/index.html-BEEvTU0O.js" as="script"><link rel="prefetch" href="/assets/index.html-omKSpvru.js" as="script"><link rel="prefetch" href="/assets/index.html-DByYdSE2.js" as="script"><link rel="prefetch" href="/assets/index.html-sTAK8geI.js" as="script"><link rel="prefetch" href="/assets/index.html-CarvJhBq.js" as="script"><link rel="prefetch" href="/assets/index.html-hiEphEjb.js" as="script"><link rel="prefetch" href="/assets/index.html-Cr4DYYH8.js" as="script"><link rel="prefetch" href="/assets/index.html-Chc0BbXV.js" as="script"><link rel="prefetch" href="/assets/index.html-BarZ9z0G.js" as="script"><link rel="prefetch" href="/assets/index.html-D3r36I1f.js" as="script"><link rel="prefetch" href="/assets/index.html-CMfXO9YT.js" as="script"><link rel="prefetch" href="/assets/index.html-BLmGkG86.js" as="script"><link rel="prefetch" href="/assets/index.html-C1Q0Kbhs.js" as="script"><link rel="prefetch" href="/assets/index.html-F1iIsOt9.js" as="script"><link rel="prefetch" href="/assets/index.html-Dw-kGbAt.js" as="script"><link rel="prefetch" href="/assets/index.html-BF4d9zdX.js" as="script"><link rel="prefetch" href="/assets/index.html-BKkvMp7s.js" as="script"><link rel="prefetch" href="/assets/index.html-FVcG2PgS.js" as="script"><link rel="prefetch" href="/assets/index.html-D5ZhaVpv.js" as="script"><link rel="prefetch" href="/assets/index.html-CuMwvkxU.js" as="script"><link rel="prefetch" href="/assets/index.html-sZOS7V9t.js" as="script"><link rel="prefetch" href="/assets/index.html-cDPiZlDK.js" as="script"><link rel="prefetch" href="/assets/index.html-DfErgTnt.js" as="script"><link rel="prefetch" href="/assets/index.html-COcfrDHw.js" as="script"><link rel="prefetch" href="/assets/index.html-CvcgaRss.js" as="script"><link rel="prefetch" href="/assets/index.html-DGHk0dku.js" as="script"><link rel="prefetch" href="/assets/index.html-CFAuaGFF.js" as="script"><link rel="prefetch" href="/assets/index.html-DFOIyQum.js" as="script"><link rel="prefetch" href="/assets/index.html-B0SwR8QD.js" as="script"><link rel="prefetch" href="/assets/index.html-DjjaRQPa.js" as="script"><link rel="prefetch" href="/assets/index.html-Bd2IpZhd.js" as="script"><link rel="prefetch" href="/assets/index.html-D0CW9RY8.js" as="script"><link rel="prefetch" href="/assets/index.html-CRE00g7_.js" as="script"><link rel="prefetch" href="/assets/index.html-t3vDXXI_.js" as="script"><link rel="prefetch" href="/assets/index.html-Z4Es-0rV.js" as="script"><link rel="prefetch" href="/assets/index.html-CZNQ8G6Y.js" as="script"><link rel="prefetch" href="/assets/index.html-CEhT6AZ4.js" as="script"><link rel="prefetch" href="/assets/index.html-D3o56gaU.js" as="script"><link rel="prefetch" href="/assets/index.html-CX5zfwbM.js" as="script"><link rel="prefetch" href="/assets/index.html-pSof-4CH.js" as="script"><link rel="prefetch" href="/assets/index.html-DT3biL2X.js" as="script"><link rel="prefetch" href="/assets/index.html-DeeeiEqi.js" as="script"><link rel="prefetch" href="/assets/index.html-B_nQk3jo.js" as="script"><link rel="prefetch" href="/assets/index.html-CKcckw8W.js" as="script"><link rel="prefetch" href="/assets/index.html-CVtIhG9C.js" as="script"><link rel="prefetch" href="/assets/index.html-DE0LKIMj.js" as="script"><link rel="prefetch" href="/assets/index.html-CDpD_DoE.js" as="script"><link rel="prefetch" href="/assets/index.html-C5GcV1Nf.js" as="script"><link rel="prefetch" href="/assets/index.html-Cy5rdvGV.js" as="script"><link rel="prefetch" href="/assets/index.html-C8ED3fka.js" as="script"><link rel="prefetch" href="/assets/index.html-Cmp3gw1U.js" as="script"><link rel="prefetch" href="/assets/index.html-DpHKn9QS.js" as="script"><link rel="prefetch" href="/assets/index.html-COJAIArZ.js" as="script"><link rel="prefetch" href="/assets/index.html-mWBwMRyo.js" as="script"><link rel="prefetch" href="/assets/index.html-BjFvhCW0.js" as="script"><link rel="prefetch" href="/assets/index.html-BgkgPtFi.js" as="script"><link rel="prefetch" href="/assets/index.html-CT0lhzsB.js" as="script"><link rel="prefetch" href="/assets/index.html-B318OCk_.js" as="script"><link rel="prefetch" href="/assets/index.html-CTunxX8D.js" as="script"><link rel="prefetch" href="/assets/index.html-CKt1n7-l.js" as="script"><link rel="prefetch" href="/assets/index.html-DtQgiPVZ.js" as="script"><link rel="prefetch" href="/assets/index.html-DSr7uR6A.js" as="script"><link rel="prefetch" href="/assets/index.html-DjAD_z3I.js" as="script"><link rel="prefetch" href="/assets/index.html-CvyR_JF3.js" as="script"><link rel="prefetch" href="/assets/index.html-Ce-eKHM2.js" as="script"><link rel="prefetch" href="/assets/index.html-BDcJbQ9y.js" as="script"><link rel="prefetch" href="/assets/index.html-CIAvUA2t.js" as="script"><link rel="prefetch" href="/assets/index.html-BZdhcrK0.js" as="script"><link rel="prefetch" href="/assets/index.html-BiaeKJ-Z.js" as="script"><link rel="prefetch" href="/assets/index.html-JeyWC5ov.js" as="script"><link rel="prefetch" href="/assets/index.html-BL7zOj2A.js" as="script"><link rel="prefetch" href="/assets/index.html-Cq3zBfD8.js" as="script"><link rel="prefetch" href="/assets/index.html-B7E4CObF.js" as="script"><link rel="prefetch" href="/assets/index.html-BSRzPn4V.js" as="script"><link rel="prefetch" href="/assets/index.html-BlteqeJS.js" as="script"><link rel="prefetch" href="/assets/index.html-Comb7mlE.js" as="script"><link rel="prefetch" href="/assets/index.html-lcWKsCns.js" as="script"><link rel="prefetch" href="/assets/index.html-JzWmyMPo.js" as="script"><link rel="prefetch" href="/assets/index.html-ClJqDpYv.js" as="script"><link rel="prefetch" href="/assets/index.html-CXQIPQKa.js" as="script"><link rel="prefetch" href="/assets/index.html-DdtjgfDP.js" as="script"><link rel="prefetch" href="/assets/index.html-0S68M0PP.js" as="script"><link rel="prefetch" href="/assets/index.html-BWhpb1hn.js" as="script"><link rel="prefetch" href="/assets/index.html-ji9_diJR.js" as="script"><link rel="prefetch" href="/assets/index.html-CuB1bFd5.js" as="script"><link rel="prefetch" href="/assets/index.html-ChgT_BpB.js" as="script"><link rel="prefetch" href="/assets/index.html-hLkLAPtK.js" as="script"><link rel="prefetch" href="/assets/index.html-D9RTcaI3.js" as="script"><link rel="prefetch" href="/assets/index.html-Dh9z8zmS.js" as="script"><link rel="prefetch" href="/assets/index.html-C131pVSr.js" as="script"><link rel="prefetch" href="/assets/index.html-BOlCLOmT.js" as="script"><link rel="prefetch" href="/assets/index.html-DHArtE_K.js" as="script"><link rel="prefetch" href="/assets/index.html-5tJoKqqi.js" as="script"><link rel="prefetch" href="/assets/index.html-Dh1So-Bi.js" as="script"><link rel="prefetch" href="/assets/index.html-CnJq2smI.js" as="script"><link rel="prefetch" href="/assets/index.html-D5BxCapP.js" as="script"><link rel="prefetch" href="/assets/index.html-CpiBZ4p2.js" as="script"><link rel="prefetch" href="/assets/index.html-82N0cK70.js" as="script"><link rel="prefetch" href="/assets/index.html-BVsCdaEA.js" as="script"><link rel="prefetch" href="/assets/index.html-njql58sr.js" as="script"><link rel="prefetch" href="/assets/index.html-dRKcD8KJ.js" as="script"><link rel="prefetch" href="/assets/index.html-DdMfV8YD.js" as="script"><link rel="prefetch" href="/assets/index.html-yZ2F66mz.js" as="script"><link rel="prefetch" href="/assets/index.html-DYz9NrDp.js" as="script"><link rel="prefetch" href="/assets/index.html-eeBZ5YTG.js" as="script"><link rel="prefetch" href="/assets/index.html-xy1LptU1.js" as="script"><link rel="prefetch" href="/assets/index.html-C_kSV6b5.js" as="script"><link rel="prefetch" href="/assets/index.html-CvhskTcn.js" as="script"><link rel="prefetch" href="/assets/index.html-DPKIdT13.js" as="script"><link rel="prefetch" href="/assets/index.html-DTsU1IXj.js" as="script"><link rel="prefetch" href="/assets/index.html-CW5uJFby.js" as="script"><link rel="prefetch" href="/assets/index.html-BYDDMtt2.js" as="script"><link rel="prefetch" href="/assets/index.html-BZOQrgLd.js" as="script"><link rel="prefetch" href="/assets/index.html-D0SWSOQ_.js" as="script"><link rel="prefetch" href="/assets/index.html-Bv_O6GRA.js" as="script"><link rel="prefetch" href="/assets/index.html-zXiXq_OJ.js" as="script"><link rel="prefetch" href="/assets/index.html-DafPYBZB.js" as="script"><link rel="prefetch" href="/assets/index.html-DKWGZc9U.js" as="script"><link rel="prefetch" href="/assets/index.html-De0ZxxlT.js" as="script"><link rel="prefetch" href="/assets/index.html-BjItsCeu.js" as="script"><link rel="prefetch" href="/assets/index.html-DVcHdcUs.js" as="script"><link rel="prefetch" href="/assets/index.html-Dd_zGOIk.js" as="script"><link rel="prefetch" href="/assets/index.html-Dfam6Vl7.js" as="script"><link rel="prefetch" href="/assets/index.html-vG5LyA-x.js" as="script"><link rel="prefetch" href="/assets/index.html-BBSap-BX.js" as="script"><link rel="prefetch" href="/assets/index.html-C_Erj9_E.js" as="script"><link rel="prefetch" href="/assets/index.html-DCd4mdO3.js" as="script"><link rel="prefetch" href="/assets/index.html-C8y3BQvZ.js" as="script"><link rel="prefetch" href="/assets/index.html-C-7rjq2Q.js" as="script"><link rel="prefetch" href="/assets/index.html-Do-qZ9zA.js" as="script"><link rel="prefetch" href="/assets/index.html-BWw6acoB.js" as="script"><link rel="prefetch" href="/assets/index.html-B3VuWe59.js" as="script"><link rel="prefetch" href="/assets/index.html-7WNjIePF.js" as="script"><link rel="prefetch" href="/assets/index.html-B3J_Rzl0.js" as="script"><link rel="prefetch" href="/assets/index.html-IUjWe_1t.js" as="script"><link rel="prefetch" href="/assets/index.html-BxLExZo8.js" as="script"><link rel="prefetch" href="/assets/index.html-C-jx6euq.js" as="script"><link rel="prefetch" href="/assets/index.html-0RAMBT5h.js" as="script"><link rel="prefetch" href="/assets/index.html-X_rrimSb.js" as="script"><link rel="prefetch" href="/assets/index.html-BAs3Yv8q.js" as="script"><link rel="prefetch" href="/assets/index.html-fBDtiAFt.js" as="script"><link rel="prefetch" href="/assets/index.html-jNhJp0Im.js" as="script"><link rel="prefetch" href="/assets/index.html-CDW4kqht.js" as="script"><link rel="prefetch" href="/assets/index.html-BRQ3JDv_.js" as="script"><link rel="prefetch" href="/assets/index.html-Czcc0I_C.js" as="script"><link rel="prefetch" href="/assets/index.html-7gDp2VIk.js" as="script"><link rel="prefetch" href="/assets/index.html-mJwUfcGD.js" as="script"><link rel="prefetch" href="/assets/index.html-DBnutyI3.js" as="script"><link rel="prefetch" href="/assets/index.html-DLbDDP97.js" as="script"><link rel="prefetch" href="/assets/index.html-Cb_M7Hcs.js" as="script"><link rel="prefetch" href="/assets/index.html-C-kvC-uL.js" as="script"><link rel="prefetch" href="/assets/index.html-Be4HVArF.js" as="script"><link rel="prefetch" href="/assets/index.html-Bvq6uoMQ.js" as="script"><link rel="prefetch" href="/assets/index.html-_JLkwdVE.js" as="script"><link rel="prefetch" href="/assets/index.html-DBRp3QYK.js" as="script"><link rel="prefetch" href="/assets/index.html-BERVoqml.js" as="script"><link rel="prefetch" href="/assets/index.html-BXvMV3bB.js" as="script"><link rel="prefetch" href="/assets/index.html-DHkBm07J.js" as="script"><link rel="prefetch" href="/assets/index.html-1XJxmby9.js" as="script"><link rel="prefetch" href="/assets/index.html-_XtxLf3t.js" as="script"><link rel="prefetch" href="/assets/index.html-D91OHy5X.js" as="script"><link rel="prefetch" href="/assets/index.html-C0K3X5jX.js" as="script"><link rel="prefetch" href="/assets/index.html-638dLha8.js" as="script"><link rel="prefetch" href="/assets/index.html-BZ2bWIGE.js" as="script"><link rel="prefetch" href="/assets/index.html-hOORh-LA.js" as="script"><link rel="prefetch" href="/assets/index.html-CFPQYcVR.js" as="script"><link rel="prefetch" href="/assets/index.html-DZ87RPU6.js" as="script"><link rel="prefetch" href="/assets/index.html-BbOHWmEM.js" as="script"><link rel="prefetch" href="/assets/index.html-DpZr-l09.js" as="script"><link rel="prefetch" href="/assets/index.html-DHqk9hWT.js" as="script"><link rel="prefetch" href="/assets/index.html-DKaRKVHl.js" as="script"><link rel="prefetch" href="/assets/index.html-DuuO1GBz.js" as="script"><link rel="prefetch" href="/assets/index.html-CxMJ_X5_.js" as="script"><link rel="prefetch" href="/assets/index.html-BP4fqr9d.js" as="script"><link rel="prefetch" href="/assets/index.html-ComGzeD6.js" as="script"><link rel="prefetch" href="/assets/index.html-DJ9HI6dE.js" as="script"><link rel="prefetch" href="/assets/index.html-DjOd-v3k.js" as="script"><link rel="prefetch" href="/assets/index.html-inRcLhB4.js" as="script"><link rel="prefetch" href="/assets/index.html-B0ONULMV.js" as="script"><link rel="prefetch" href="/assets/index.html-ZXwGQHgj.js" as="script"><link rel="prefetch" href="/assets/index.html-IMFhope_.js" as="script"><link rel="prefetch" href="/assets/index.html-B1UNLsO_.js" as="script"><link rel="prefetch" href="/assets/index.html-DydzV70G.js" as="script"><link rel="prefetch" href="/assets/index.html-DYe2UT04.js" as="script"><link rel="prefetch" href="/assets/index.html-KaKd5sL4.js" as="script"><link rel="prefetch" href="/assets/index.html-9wNGOSVi.js" as="script"><link rel="prefetch" href="/assets/index.html-DHwtmgHE.js" as="script"><link rel="prefetch" href="/assets/index.html-CJ6929Za.js" as="script"><link rel="prefetch" href="/assets/index.html-CaZDWOKW.js" as="script"><link rel="prefetch" href="/assets/index.html-b5x2W2tj.js" as="script"><link rel="prefetch" href="/assets/index.html-B31e9vdz.js" as="script"><link rel="prefetch" href="/assets/index.html-DkJvkKE5.js" as="script"><link rel="prefetch" href="/assets/index.html-CmcJEROz.js" as="script"><link rel="prefetch" href="/assets/index.html-ZDd2YMhD.js" as="script"><link rel="prefetch" href="/assets/index.html-B1qG8G8m.js" as="script"><link rel="prefetch" href="/assets/index.html-CPMRnd2v.js" as="script"><link rel="prefetch" href="/assets/index.html-RAiuaREz.js" as="script"><link rel="prefetch" href="/assets/index.html-CNz5RTge.js" as="script"><link rel="prefetch" href="/assets/index.html-j6qrpBAf.js" as="script"><link rel="prefetch" href="/assets/index.html-Doen4AZS.js" as="script"><link rel="prefetch" href="/assets/index.html-BYyZzgW-.js" as="script"><link rel="prefetch" href="/assets/index.html-BY-HyLtt.js" as="script"><link rel="prefetch" href="/assets/index.html-DB9l16KZ.js" as="script"><link rel="prefetch" href="/assets/index.html-CT5WYxXY.js" as="script"><link rel="prefetch" href="/assets/index.html-DFql3Qoi.js" as="script"><link rel="prefetch" href="/assets/index.html-DsiYuw4K.js" as="script"><link rel="prefetch" href="/assets/index.html-BPmOfWOE.js" as="script"><link rel="prefetch" href="/assets/index.html-DFFOkD6C.js" as="script"><link rel="prefetch" href="/assets/index.html-CqQL789k.js" as="script"><link rel="prefetch" href="/assets/index.html-gLfXcVFi.js" as="script"><link rel="prefetch" href="/assets/index.html-gkGNnt3Q.js" as="script"><link rel="prefetch" href="/assets/index.html-BJtIfnnr.js" as="script"><link rel="prefetch" href="/assets/index.html-D9S9-oXk.js" as="script"><link rel="prefetch" href="/assets/index.html-D7TKkaRO.js" as="script"><link rel="prefetch" href="/assets/index.html-cJfEkQ0J.js" as="script"><link rel="prefetch" href="/assets/index.html-BXzy2gX-.js" as="script"><link rel="prefetch" href="/assets/index.html-BeJJcYCC.js" as="script"><link rel="prefetch" href="/assets/index.html-BlaA7TBl.js" as="script"><link rel="prefetch" href="/assets/404.html-WQu4vR0w.js" as="script"><link rel="prefetch" href="/assets/index.html-CQdgBS8p.js" as="script"><link rel="prefetch" href="/assets/index.html-BdgCf-OB.js" as="script"><link rel="prefetch" href="/assets/index.html-BAv1Ga_w.js" as="script"><link rel="prefetch" href="/assets/index.html-ss9WMha4.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-GXRgw7eJ.js" as="script"><link rel="prefetch" href="/assets/searchBox-default-Dp9O-qLD.js" as="script"><link rel="prefetch" href="/assets/SearchBox-Crj6xrtK.js" as="script"><link rel="prefetch" href="/assets/setupDevtools-7MC2TMWH-D1DjK_AG.js" as="script"></head><body><div id="app"><!--[--><div class="theme-plume vp-layout" vp-container data-v-0b7e05b4><!--[--><!--[--><!--]--><!--[--><span tabindex="-1" data-v-d5a8d0bc></span><a href="#VPContent" class="vp-skip-link visually-hidden" data-v-d5a8d0bc> Skip to content </a><!--]--><!----><header class="vp-nav" data-v-0b7e05b4 data-v-d34f28d6><div class="vp-navbar" vp-navbar data-v-d34f28d6 data-v-70d97d16><div class="wrapper" data-v-70d97d16><div class="container" data-v-70d97d16><div class="title" data-v-70d97d16><div class="vp-navbar-title has-sidebar" data-v-70d97d16 data-v-2c8d4622><a class="vp-link no-icon link title" href="/" data-v-2c8d4622 data-v-442a52aa><!--[--><!--[--><!--]--><!--[--><!--[--><!--[--><img class="vp-image dark logo" src="/images/blog/ava.png" alt data-v-7fbfbc9b><!--]--><!--[--><img class="vp-image light logo" src="/images/blog/ava.png" alt data-v-7fbfbc9b><!--]--><!--]--><!--]--><span data-v-2c8d4622>Jerry</span><!--[--><!--]--><!--]--><!----></a></div></div><div class="content" data-v-70d97d16><div class="content-body" data-v-70d97d16><!--[--><!--]--><div class="vp-navbar-search search" data-v-70d97d16><div class="search-wrapper" data-v-97535d1e><!----><div id="local-search" data-v-97535d1e><button type="button" class="mini-search mini-search-button" aria-label="搜索文档" data-v-97535d1e><span class="mini-search-button-container"><svg class="mini-search-search-icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="mini-search-button-placeholder">搜索文档</span></span><span class="mini-search-button-keys"><kbd class="mini-search-button-key"></kbd><kbd class="mini-search-button-key">K</kbd></span></button></div></div></div><nav aria-labelledby="main-nav-aria-label" class="vp-navbar-menu menu" data-v-70d97d16 data-v-d43c1732><span id="main-nav-aria-label" class="visually-hidden" data-v-d43c1732>Main Navigation</span><!--[--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/" tabindex="0" data-v-d43c1732 data-v-9970a379 data-v-442a52aa><!--[--><!----><span data-v-9970a379>首页</span><!--]--><!----></a><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-d43c1732 data-v-feafea4e><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-feafea4e><span class="text" data-v-feafea4e><!----><!----><span data-v-feafea4e>crash course</span><span class="vpi-chevron-down text-icon" data-v-feafea4e></span></span></button><div class="menu" data-v-feafea4e><div class="vp-menu" data-v-feafea4e data-v-709dc2b1><div class="items" data-v-709dc2b1><!--[--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-aaf95230><a class="vp-link no-icon link" href="/crash-course/computer-science/1/" data-v-aaf95230 data-v-442a52aa><!--[--><!----> Computer Science<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-aaf95230><a class="vp-link no-icon link" href="/crash-course/economics/1/" data-v-aaf95230 data-v-442a52aa><!--[--><!----> Economics<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-d43c1732 data-v-feafea4e><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-feafea4e><span class="text" data-v-feafea4e><!----><!----><span data-v-feafea4e>计算机</span><span class="vpi-chevron-down text-icon" data-v-feafea4e></span></span></button><div class="menu" data-v-feafea4e><div class="vp-menu" data-v-feafea4e data-v-709dc2b1><div class="items" data-v-709dc2b1><!--[--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-aaf95230><a class="vp-link no-icon link" href="/java/" data-v-aaf95230 data-v-442a52aa><!--[--><!----> Java<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-aaf95230><a class="vp-link no-icon link" href="/networking/vhlkdsuw/" data-v-aaf95230 data-v-442a52aa><!--[--><!----> 计算机网络<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-aaf95230><a class="vp-link no-icon link" href="/data-structure/leu82fhp/" data-v-aaf95230 data-v-442a52aa><!--[--><!----> 数据结构<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-aaf95230><a class="vp-link no-icon link" href="/computer-system/lbudvq6j/" data-v-aaf95230 data-v-442a52aa><!--[--><!----> 操作系统<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-aaf95230><a class="vp-link no-icon link" href="/db/d7ls353u/" data-v-aaf95230 data-v-442a52aa><!--[--><!----> 数据库<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-aaf95230><a class="vp-link no-icon link" href="/pattern-design/strategy/" data-v-aaf95230 data-v-442a52aa><!--[--><!----> 设计模式<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-aaf95230><a class="vp-link no-icon link" href="/regular/" data-v-aaf95230 data-v-442a52aa><!--[--><!----> 正则表达式<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-aaf95230><a class="vp-link no-icon link" href="/git/" data-v-aaf95230 data-v-442a52aa><!--[--><!----> git<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/anpu/" tabindex="0" data-v-d43c1732 data-v-9970a379 data-v-442a52aa><!--[--><!----><span data-v-9970a379>安溥·與你握手</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/sentences/" tabindex="0" data-v-d43c1732 data-v-9970a379 data-v-442a52aa><!--[--><!----><span data-v-9970a379>醍醐灌顶</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/about/" tabindex="0" data-v-d43c1732 data-v-9970a379 data-v-442a52aa><!--[--><!----><span data-v-9970a379>关于</span><!--]--><!----></a><!--]--><!--]--></nav><!----><div class="vp-navbar-appearance appearance" data-v-70d97d16 data-v-a295abf6><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-a295abf6 data-v-537740e0 data-v-d84fedac><span class="check" data-v-d84fedac><span class="icon" data-v-d84fedac><!--[--><span class="vpi-sun sun" data-v-537740e0></span><span class="vpi-moon moon" data-v-537740e0></span><!--]--></span></span></button></div><div class="vp-social-links vp-navbar-social-links social-links" data-v-70d97d16 data-v-ad52545c data-v-40bac536><!--[--><a class="vp-social-link no-icon" href="https://github.com/jerrySheh" aria-label="github" target="_blank" rel="noopener" data-v-40bac536 data-v-67b21932><span class="vpi-social-github" /></a><!--]--></div><div class="vp-flyout vp-navbar-extra extra" data-v-70d97d16 data-v-652282fd data-v-feafea4e><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-feafea4e><span class="vpi-more-horizontal icon" data-v-feafea4e></span></button><div class="menu" data-v-feafea4e><div class="vp-menu" data-v-feafea4e data-v-709dc2b1><!----><!--[--><!--[--><!----><div class="group" data-v-652282fd><div class="item appearance" data-v-652282fd><p class="label" data-v-652282fd>外观</p><div class="appearance-action" data-v-652282fd><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-652282fd data-v-537740e0 data-v-d84fedac><span class="check" data-v-d84fedac><span class="icon" data-v-d84fedac><!--[--><span class="vpi-sun sun" data-v-537740e0></span><span class="vpi-moon moon" data-v-537740e0></span><!--]--></span></span></button></div></div></div><div class="group" data-v-652282fd><div class="item social-links" data-v-652282fd><div class="vp-social-links social-links-list" data-v-652282fd data-v-40bac536><!--[--><a class="vp-social-link no-icon" href="https://github.com/jerrySheh" aria-label="github" target="_blank" rel="noopener" data-v-40bac536 data-v-67b21932><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="vp-navbar-hamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="nav-screen" data-v-70d97d16 data-v-2b50024d><span class="container" data-v-2b50024d><span class="top" data-v-2b50024d></span><span class="middle" data-v-2b50024d></span><span class="bottom" data-v-2b50024d></span></span></button></div></div></div></div><div class="divider" data-v-70d97d16><div class="divider-line" data-v-70d97d16></div></div></div><!----></header><div class="vp-local-nav reached-top is-blog" data-v-0b7e05b4 data-v-1dc3518c><button class="menu" aria-expanded="false" aria-controls="SidebarNav" data-v-1dc3518c><span class="vpi-align-left menu-icon" data-v-1dc3518c></span><span class="menu-text" data-v-1dc3518c>Menu</span></button><div class="vp-local-nav-outline-dropdown" style="--vp-vh:0px;" data-v-1dc3518c data-v-423a73ec><button data-v-423a73ec>返回顶部</button><!----></div></div><aside class="vp-sidebar" vp-sidebar data-v-0b7e05b4 data-v-360082b7><div class="curtain" data-v-360082b7></div><nav id="SidebarNav" class="nav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-360082b7><span id="sidebar-aria-label" class="visually-hidden" data-v-360082b7> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-473fd05b><section class="vp-sidebar-item sidebar-item level-0 has-active" data-v-473fd05b data-v-b88148be><!----><div class="items" data-v-b88148be><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/networking/vhlkdsuw/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>计算机网络漫游</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/networking/t8nor125/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>计算机网络——传输层探究</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/networking/x8i1v6xq/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>计算机网络——网络层探究</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/networking/7ic54ih1/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>HTTP之旅</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/networking/9l1mwxe4/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>Socket编程实践（Java & Python实现）</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/networking/2jxf5qiz/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>TCP与UDP的区别</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/networking/4cfyabo6/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>TCP之旅</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/networking/zmzq31bs/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>当你输入一个网址的时候，实际会发生什么?</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/networking/zuxk3sa2/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>浅谈 socket 编程</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><!--[--><div id="VPContent" vp-content class="vp-content has-sidebar" data-v-0b7e05b4 data-v-eb709286><div class="has-sidebar has-aside vp-doc-container" data-v-e798167f><!--[--><!--]--><div class="container" data-v-e798167f><div class="aside" vp-outline data-v-e798167f><div class="aside-curtain" data-v-e798167f></div><div class="aside-container" data-v-e798167f><div class="aside-content" data-v-e798167f><div class="vp-doc-aside" data-v-e798167f data-v-5976474c><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="vp-doc-aside-outline" role="navigation" data-v-5976474c data-v-aa56eba0><div class="content" data-v-aa56eba0><div class="outline-marker" data-v-aa56eba0></div><div id="doc-outline-aria-label" aria-level="2" class="outline-title" role="heading" data-v-aa56eba0><span data-v-aa56eba0>此页内容</span><span class="vpi-print icon" data-v-aa56eba0></span></div><ul class="root" data-v-aa56eba0 data-v-54c74388><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-5976474c></div><!--[--><!--]--></div></div></div></div><div class="content" data-v-e798167f><div class="content-container" data-v-e798167f><!--[--><!--]--><main class="main" data-v-e798167f><nav class="vp-breadcrumb" data-v-e798167f data-v-2901466a><ol vocab="https://schema.org/" typeof="BreadcrumbList" data-v-2901466a><!--[--><li property="itemListElement" typeof="ListItem" data-v-2901466a><a class="vp-link no-icon link breadcrumb" href="/" property="item" typeof="WebPage" data-v-2901466a data-v-442a52aa><!--[-->首页<!--]--><!----></a><span class="vpi-chevron-right" data-v-2901466a></span><meta property="position" content="1" data-v-2901466a></li><li property="itemListElement" typeof="ListItem" data-v-2901466a><a class="vp-link no-icon link breadcrumb current" href="/networking/4cfyabo6/" property="item" typeof="WebPage" data-v-2901466a data-v-442a52aa><!--[-->TCP之旅<!--]--><!----></a><!----><meta property="position" content="2" data-v-2901466a></li><!--]--></ol></nav><!--[--><h1 class="vp-doc-title page-title" data-v-7007a277>TCP之旅 <!----></h1><div class="vp-doc-meta" data-v-7007a277><p class="reading-time" data-v-7007a277><span class="vpi-books icon" data-v-7007a277></span><span data-v-7007a277>3185字</span><span data-v-7007a277>约11分钟</span></p><p data-v-7007a277><span class="vpi-tag icon" data-v-7007a277></span><!--[--><span class="vp-link no-icon tag vp-tag-evn7" href="/" data-v-7007a277 data-v-442a52aa><!--[-->计算机网络<!--]--><!----></span><!--]--></p><p class="create-time" data-v-7007a277><span class="vpi-clock icon" data-v-7007a277></span><span data-v-7007a277>2017-12-08</span></p></div><!--]--><div class="vp-doc plume-content _networking_4cfyabo6_ external-link-icon-enabled" vp-content data-v-e798167f><h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言"><span>前言</span></a></h2><p>前面两篇介绍 Socket 的文章中，简单描述了 Socket 网络编程的过程。这一篇，主要介绍一下 TCP 的工作原理。包含以下六点：</p><ol><li>TCP连接简介</li><li>TCP报文段</li><li>连接的建立和断开（三次握手，四次挥手）</li><li>TCP可靠在哪里（序号、ACK回复、超时重传）</li><li>滑窗机制</li><li>拥塞控制机制</li></ol><hr><h2 id="一、tcp连接简介" tabindex="-1"><a class="header-anchor" href="#一、tcp连接简介"><span>一、TCP连接简介</span></a></h2><p>TCP 全称 Transmission Control Protocol，传输控制协议，是传输层的协议。它的任务是将应用层的数据准确地交付给网络层。</p><p>两个应用程序，如果用TCP来发送数据，那么他们必须先互相“握手”。也就是说，在正式传数据之前，要先互相发送一些预备报文段，以建立确保数据传输的参数。所以我们说，<strong>TCP是面向连接的(connection-oriented)，也是可靠的传输</strong>。</p><p>虽然TCP是面向连接的，但是这种“连接”，不是端到端线路意义上的连接，也不是虚电路。TCP的连接，是保留在两个端系统的状态当中的。因此，中间路由器对TCP连接是视而不见的。</p><p>TCP提供的是<code>全双工服务</code>，数据可以从A到B，也能从B到A。同时，TCP是<code>点对点</code>的，TCP连接是单个发送方与单个接收方之间的连接，不能多播。（但这并不代表一个服务器不能与多个客户端建立连接，只是说，一个连接只能在两台主机之间，如果一台主机要接收另外两台主机的数据，需要为那两台主机分别建立TCP连接）</p><p><img src="/images/TCPconnection.png" alt="TCPconnection"></p><h3 id="tcp是怎样建立连接的-三次握手" tabindex="-1"><a class="header-anchor" href="#tcp是怎样建立连接的-三次握手"><span>TCP是怎样建立连接的（三次握手）？</span></a></h3><ol><li>首先，客户端先发送一个特殊的TCP报文段</li><li>服务器返回另一个特殊的报文段响应</li><li>客户端用第三个特殊报文段作为响应</li></ol><p>前两个报文段，不承载“有效载荷”（不包含应用层的数据），仅仅是打招呼。后一个报文段，可以承载有效载荷。由于在这两台主机之间发送了 3 个报文段，所以这种连接建立的过程，我们称之为“三次握手”，稍后我们详细讨论。</p><p><img src="/images/TCP3wayhandshake.png" alt="TCP3wayhandshake"></p><hr><h2 id="二、tcp报文段" tabindex="-1"><a class="header-anchor" href="#二、tcp报文段"><span>二、TCP报文段</span></a></h2><p>TCP将应用程序的报文（message）分组，再为每个分组加上<code>TCP首部</code>，形成多个<code>TCP报文段（TCP segment）</code>，再下传给网络层。报文段的首部如下图：</p><p><img src="/images/TCPsegment.png" alt="TCPsegment"></p><p>首部包含了以下信息：</p><ol><li><strong>源端口号（source port）</strong> 和 <strong>目的端口号(destination port)</strong> ：各16位，因为16位最大能表示的数字是65535，所以端口号最大值也只能是65535。</li><li><strong>序号字段(sequence number field)</strong> ：32位，用来实现可靠数据传输，例如一个500000字节的文件被分为500个TCP报文段，初始序号可以随意指定，后续的序号是前面序号+携带的字节数，例如初始序号79，每个报文段携带1000字节，第二个序号就是1079</li><li><strong>确认号字段(Acknowledgement number field)</strong> ：32位，也是用来实现可靠数据传输，表示期望对方发送的下一字节的序号</li><li><strong>接收窗口字段(receive windows field)</strong> ：16位，用于流量控制，表示接收方愿意接受的字节数量</li><li><strong>首部长度字段(header length field)</strong> ：4位，TCP的首部长度是可变的，这个字段表示首部长度</li><li><strong>选项字段(options field)</strong> ：不定位数，用作窗口调节因子</li><li><strong>标志字段(flag field)</strong> ：6位，包括ACK、RST、SYN、FIN、PSH、URG，各占1位</li></ol><p>我们主要关注三个点：</p><ol><li>一个TCP头部需要包含出发端口和目的地端口。这些与IP头中的两个IP地址共同确定了连接。</li><li>每个TCP片段都有序号。这些序号最终将数据部分的文本片段整理成为文本流。</li><li>只有标志字段的ACK位设定的时候，确认号字段才有效。ACK确认号说明了接收方期待接收的下一个片段，所以ACK确认号为最后接收到的片段序号加1。</li></ol><hr><h2 id="三、tcp连接的建立和断开" tabindex="-1"><a class="header-anchor" href="#三、tcp连接的建立和断开"><span>三、TCP连接的建立和断开</span></a></h2><h3 id="三次握手" tabindex="-1"><a class="header-anchor" href="#三次握手"><span>三次握手</span></a></h3><p>前面提到，TCP建立连接的过程称为三次握手。其详细过程如下：</p><ol><li><strong>第一步</strong>：客户端先发送一个特殊的TCP报文段，不包含应用层数据。但首部标志字段的SYN位被置为1（称为SYN报文段），并随机指定一个初始序号（seq）。（为什么初始序号要随机，主要是安全方面考虑）。</li><li><strong>第二步</strong>：服务器收到客户端的SYN报文段后，就会为该TCP连接分配TCP缓存和变量，并回复一个报文段（称为SYNACK报文段）。在这个回复报文段里，SYN位也是被置为1，确认号ack置为客户端刚刚发来的初始序号seq+1，并随机指定一个自己的初始序号seq。</li><li><strong>第三步</strong>：客户端收到服务器的SYNACK报文段后，在客户端为该TCP连接分配缓存和变量，同时也回复了一个报文段，此时连接已经建立，所以SYN置为0，ACK确认号为服务器的初始序号seq+1，seq为自己第一步的seq+1</li></ol><h3 id="四次挥手" tabindex="-1"><a class="header-anchor" href="#四次挥手"><span>四次挥手</span></a></h3><p>当TCP连接的任意一方想断开连接时，将会发起断开信号，连接结束后，主机里的TCP连接资源（缓存和变量）随即被释放。断开的过程需要通信四次，所以称为四次挥手。其详细过程如下：</p><ol><li><strong>第一步</strong>：客户端发起关闭连接命令。此时会向服务器发送一个特殊的报文段，标志字段的<code>FIN</code>位被置为<code>1</code>，随后客户端进入 <code>FIN_WAIT_1</code> 状态，该状态表示客户端正在等待服务器的ACK确认。</li><li><strong>第二步</strong>：服务器收到这个特殊的报文段后，回复一个确认报文段，收到这个确认报文段后，客户端进入 <code>FIN_WAIT_2</code> 状态，该状态表示客户端期望收到服务器的可以终止命令。</li><li><strong>第三步</strong>：稍后，服务器也向客户端发起一个<code>FIN</code>位为<code>1</code>的特殊报文段，表示可以终止。</li><li><strong>第四步</strong>：客户端回复一个确认报文段进行确认，之后进入 <code>TIME_WAIT</code> 状态等待30秒（目的是确认报文若丢失可以重传），之后连接断开。</li></ol><p><img src="/images/networking/tcp.jpg" alt="tcp"></p><hr><h2 id="四、tcp-为何可靠" tabindex="-1"><a class="header-anchor" href="#四、tcp-为何可靠"><span>四、TCP 为何可靠</span></a></h2><h3 id="流-和次序" tabindex="-1"><a class="header-anchor" href="#流-和次序"><span>“流”和次序</span></a></h3><p>我们之前提到，Linux的哲学是“一切皆文件”，一切都可以用“打开open –&gt; 读写write/read –&gt; 关闭close”的模式来操作。计算机程序之间的通信，是一个进程写入文本流(byte stream)，而另一个进程读取这个流。<strong>TCP协议虚拟了文本流的通信</strong>。</p><p>要知道，在两台相隔很远的主机中，隔着许许多多的路由器和交换机，因此数据发送的时候，先发的数据可能会后到。好在TCP协议确保了数据到达的顺序与文本流顺序相符。这就是为什么TCP报文段里面需要有序号的原因。TCP接收方将接收到的许许多多报文段按照序号排列起来，组成原始数据。</p><h3 id="收到请回复" tabindex="-1"><a class="header-anchor" href="#收到请回复"><span>“收到请回复”</span></a></h3><p>TCP为什么需要确认号呢？我们知道，TCP是全双工的协议，在A主机向B主机发送数据的同时，B主机也能向A主机发送数据（在同一个TCP连接中）。例如，A向B发送8字节数据时携带了序号，seq=79，B向A发数据时也需要携带一个序号seq=45，同时，“回复”确认收到了A主机seq=79的序号，并期望接收A主机seq=87（为什么不是80，因为前一个序号有8字节）的序号，所以就有了确认号ack=87。</p><p>也就是说，TCP发送方每发送一个报文段，接收方都会回复一个确认号。以确保这个片段收到了。比如已经接收到了片段1，片段2，片段3，那么接收方就开始期待片段4。值得注意的是，如果此时收到了片段5 片段6，也不会丢弃，会暂时存起来，等到片段4到达再拼接，但是如果此时收到了片段9，那么接收方就可能拒绝接收了。</p><h3 id="报文段丢了-重发" tabindex="-1"><a class="header-anchor" href="#报文段丢了-重发"><span>报文段丢了，重发</span></a></h3><p>IP协议是不可靠的，也就是说，交付给网络层的报文段，可能会传着传着就丢了。那咋办？ TCP有一个定时器超时，规定如果一段时间之后，还没有收到接收方的确认（ACK），就默认这个报文段丢了。就会重新发一个过去，直到接收方回复确认收到。</p><p>那么，如果说，这个报文段发过去了，接收方也接收到了。接收方返回给发送方的“确认”信息丢了，怎么办呢？ 这种情况下，发送方依然会重发。 接收方一看，咦你居然发了两个一样的报文段？就会自动丢弃其中的一个了，当然，还要给发送方再发一次“收到”回复，以免发送方孜孜不倦、不辞劳苦地一直重发、一直重发。</p><hr><h2 id="五、滑窗" tabindex="-1"><a class="header-anchor" href="#五、滑窗"><span>五、滑窗</span></a></h2><p>我们已经知道，TCP发送方片段1发出去，接收方回复ACK已收到1，发送方再发片段2，接收方再回复ACK已收到2......</p><p>在这种模式下，发送方保持发送-&gt;等待ACK-&gt;发送-&gt;等待ACK...的状态，虽然很“可靠”，但是效率太慢了。为了提高效率，同时发多个片段，又怕后发的先到了，怎么办呢？</p><p>我们可以这么做：利用缓存保留一些“不那么乱”的片段，期望能在短时间内补充上之前的片段(暂不处理，但发送相应的ACK)；对于“乱”的比较厉害的片段，则将它们拒绝(不处理，也不发送对应的ACK)。</p><p>滑窗(sliding window)被同时应用于接收方和发送方，以解决以上问题。发送方和接收方各有一个滑窗。当片段位于滑窗中时，表示TCP正在处理该片段。滑窗中可以有多个片段，也就是可以同时处理多个片段。滑窗越大，越大的滑窗同时处理的片段数目越多(当然，计算机也必须分配出更多的缓存供滑窗使用)。</p><p>TCP有专门的算法动态调整滑窗的大小。</p><hr><h2 id="六、tcp拥塞控制" tabindex="-1"><a class="header-anchor" href="#六、tcp拥塞控制"><span>六、TCP拥塞控制</span></a></h2><p>在TCP协议中，我们使用<code>连接</code>记录TCP两端的状态，使用<code>序号和分段</code>保证了TCP传输的有序，使用<code>滑窗</code>（中的某些机制）来实现发送方和接收方处理能力的匹配，并使用<code>重复发送</code>来实现TCP传输的可靠性。</p><p>一切看似都很美好，但是，随着互联网的发展，越来越多的主机之间要相互发送数据，有时候中间路由器会处理不过来从而发生丢包，一丢包，这些基于TCP的主机就又重新发送，路由器不堪重负，就会发生更严重的丢包，构成了一个恶性循环。这称为堵塞崩溃。</p><p>因此，为了避免发送堵塞崩溃，TCP加入了<code>拥塞控制机制</code>。当TCP发送方探测到网络拥堵时，会控制自己发送片段的速率，以缓解网络的交通状况。</p><h3 id="如何探测网络拥堵" tabindex="-1"><a class="header-anchor" href="#如何探测网络拥堵"><span>如何探测网络拥堵</span></a></h3><p>当发生ACK超时和重复ACK。发送方就认为TCP片段丢失，则认为网络中出现堵塞。</p><h3 id="如何控制速率" tabindex="-1"><a class="header-anchor" href="#如何控制速率"><span>如何控制速率</span></a></h3><p>TCP协议通过控制滑窗(sliding window)大小来控制发送速率。在TCP滑窗管理中，有一个窗口限制，就是advertised window size，以实现TCP流量控制。TCP还会维护一个congestion window size，以根据网络状况来调整滑窗大小。真实滑窗大小取这两个滑窗限制的最小值，从而同时满足两个限制 (流量控制和堵塞控制)。</p><p>（TCP拥塞控制和滑窗的内容来自<a href="http://www.cnblogs.com/vamei/archive/2012/12/18/2822739.html" target="_blank" rel="noopener noreferrer">vamei的博客</a>，vamei写得太好了，值得好好学习）</p></div></main><footer class="vp-doc-footer" data-v-e798167f data-v-f2100d82><!--[--><!--]--><!----><div class="contributors" data-v-f2100d82><span class="contributors-label" data-v-f2100d82>贡献者: </span><span class="contributors-info" data-v-f2100d82><!--[--><!--[--><span class="contributor" data-v-f2100d82>jerrysheh</span><!----><!--]--><!--]--></span></div><nav class="prev-next" data-v-f2100d82><div class="pager" data-v-f2100d82><a class="vp-link no-icon link pager-link prev" href="/networking/2jxf5qiz/" data-v-f2100d82 data-v-442a52aa><!--[--><span class="desc" data-v-f2100d82>上一页</span><span class="title" data-v-f2100d82>TCP与UDP的区别</span><!--]--><!----></a></div><div class="pager" data-v-f2100d82><a class="vp-link no-icon link pager-link next" href="/networking/zmzq31bs/" data-v-f2100d82 data-v-442a52aa><!--[--><span class="desc" data-v-f2100d82>下一页</span><span class="title" data-v-f2100d82>当你输入一个网址的时候，实际会发生什么?</span><!--]--><!----></a></div></nav></footer><!----><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!--]--><button style="display:none;" type="button" class="vp-back-to-top" aria-label="back to top" data-v-0b7e05b4 data-v-c122fdb6><span class="percent" data-allow-mismatch data-v-c122fdb6>0%</span><span class="show icon vpi-back-to-top" data-v-c122fdb6></span><svg aria-hidden="true" data-v-c122fdb6><circle cx="50%" cy="50%" data-allow-mismatch style="stroke-dasharray:calc(0% - 12.566370614359172px) calc(314.1592653589793% - 12.566370614359172px);" data-v-c122fdb6></circle></svg></button><footer class="vp-footer has-sidebar" vp-footer data-v-0b7e05b4 data-v-368f94aa><div class="container" data-v-368f94aa><p class="message" data-v-368f94aa>Powered by <a target="_blank" href="https://v2.vuepress.vuejs.org/">VuePress</a> & <a target="_blank" href="https://theme-plume.vuejs.press">vuepress-theme-plume</a></p><p class="copyright" data-v-368f94aa>
        Copyright © 2017-2024 Jerry 
        访客人数：<span id="busuanzi_value_site_uv" </span>
      </p></div></footer><!--[--><!--]--><!--]--></div><!--[--><!--]--><!--]--></div><script type="module" src="/assets/app-D22ydJtp.js" defer></script></body></html>